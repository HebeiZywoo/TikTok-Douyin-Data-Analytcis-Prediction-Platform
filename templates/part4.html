{% extends 'base.html' %}
{% block content %}
    {% load static %}
    <div class="page-content">
        <h1 class="page-title">
            <i class="fa fa-home"></i>
            情感分析
        </h1>
        <section class="no-padding-bottom">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="block"
                             style="background: #f8f9fc; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.05);">
                            <div class="title">
                                <strong class="d-block" style="color: #4e73df; font-size: 1.2rem;">情感得分区间</strong>
                                <span class="d-block text-muted small">情感得分</span>
                            </div>
                            <div class="block-body p-0">
                                <div id="main1" style="width: 100%;height: 600px; border-radius: 8px;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="block"
                             style="background: #f8f9fc; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.05);">
                            <div class="title">
                                <strong class="d-block" style="color: #4e73df; font-size: 1.2rem;">情感倾向分布</strong>
                                <span class="d-block text-muted small">情感倾向占比</span>
                            </div>
                            <div class="block-body p-0">
                                <div id="main2" style="width: 100%;height: 600px; border-radius: 8px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <script src="{% static 'js/echarts.js' %}"></script>
    <script src="{% static 'js/china.js' %}"></script>
   <script>
    var chartDom = document.getElementById('main1');
    var myChart = echarts.init(chartDom, 'vintage');  // 使用vintage主题作为基础

    var option = {
        title: {
            text: '数据分布统计',
            subtext: '可视化分析',
            left: 'center',
            textStyle: {
                fontSize: 22,
                fontWeight: 'bold',
                color: '#333',
                fontFamily: 'Microsoft YaHei'
            },
            subtextStyle: {
                fontSize: 14,
                color: '#999'
            }
        },
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'shadow'
            },
            formatter: function(params) {
                return `<div style="font-weight:bold;margin-bottom:5px;">${params[0].name}</div>
                        <div style="display:flex;align-items:center;">
                            <span style="display:inline-block;width:10px;height:10px;background:${params[0].color};margin-right:8px;border-radius:50%;"></span>
                            数值: <span style="color:#ee6666;font-weight:bold;margin-left:5px;">${params[0].value}</span>
                        </div>`;
            }
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '10%',
            top: '20%',
            containLabel: true
        },
        xAxis: {
            type: 'category',
            data: {{ name_list|safe }},
            axisLine: {
                lineStyle: {
                    color: '#999'
                }
            },
            axisLabel: {
                interval: 0,
                rotate: 30,  // 如果标签过长可以旋转
                color: '#666',
                fontSize: 12
            },
            axisTick: {
                alignWithLabel: true
            }
        },
        yAxis: {
            type: 'value',
            axisLine: {
                show: true,
                lineStyle: {
                    color: '#999'
                }
            },
            splitLine: {
                lineStyle: {
                    type: 'dashed',
                    color: '#eee'
                }
            },
            axisLabel: {
                color: '#666',
                formatter: '{value}'
            }
        },
        series: [{
            name: '数值',
            type: 'bar',
            barWidth: '60%',
            data: {{ value_list|safe }},
            itemStyle: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    { offset: 0, color: '#83bff6' },
                    { offset: 0.5, color: '#188df0' },
                    { offset: 1, color: '#0052d9' }
                ]),
                borderRadius: [4, 4, 0, 0],
                shadowColor: 'rgba(0, 0, 0, 0.3)',
                shadowBlur: 6,
                shadowOffsetY: 3
            },
            emphasis: {
                itemStyle: {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                        { offset: 0, color: '#ff9a9e' },
                        { offset: 0.5, color: '#fad0c4' },
                        { offset: 1, color: '#fad0c4' }
                    ])
                }
            },
            showBackground: true,
            backgroundStyle: {
                color: 'rgba(200, 220, 240, 0.2)',
                borderRadius: [4, 4, 0, 0]
            },
            label: {
                show: true,
                position: 'top',
                color: '#333',
                fontWeight: 'bold',
                formatter: '{c}'
            },
            animationType: 'elastic',
            animationDelay: function (idx) {
                return idx * 100;
            }
        }],
        color: ['#5470c6'],
        textStyle: {
            fontFamily: 'Microsoft YaHei, Arial, sans-serif'
        }
    };

    // 添加缩放功能（适用于数据较多时）
    if({{ name_list|safe }}.length > 10) {
        option.dataZoom = [{
            type: 'slider',
            show: true,
            xAxisIndex: [0],
            start: 0,
            end: 50,
            bottom: '5%',
            height: 20
        }];
    }

    option && myChart.setOption(option);

    // 响应式调整
    window.addEventListener('resize', function() {
        myChart.resize();
    });
</script>

<script>
    var chartDom = document.getElementById('main2');
    var myChart = echarts.init(chartDom);
    var option;

    option = {
        backgroundColor: '#f5f7fa',
        tooltip: {
            trigger: 'item',
            formatter: '{a} <br/>{b}: {c} ({d}%)',
            backgroundColor: 'rgba(0,0,0,0.7)',
            borderColor: '#333',
            borderWidth: 1,
            textStyle: {
                color: '#fff',
                fontSize: 14
            },
            padding: [10, 15]
        },
        legend: {
            top: '5%',
            left: 'center',
            textStyle: {
                color: '#666',
                fontSize: 14,
                fontWeight: 'normal'
            },
            itemWidth: 12,
            itemHeight: 12,
            itemGap: 20
        },
        series: [
            {
                name: '数据分布',
                type: 'pie',
                radius: ['45%', '75%'],
                center: ['50%', '55%'],
                avoidLabelOverlap: false,
                itemStyle: {
                    borderRadius: 8,
                    borderColor: '#fff',
                    borderWidth: 3,
                    shadowBlur: 10,
                    shadowColor: 'rgba(0, 0, 0, 0.2)'
                },
                label: {
                    show: false,
                    position: 'center',
                    formatter: '{b}\n{d}%',
                    fontSize: 16,
                    fontWeight: 'bold',
                    color: '#333',
                    lineHeight: 26
                },
                emphasis: {
                    label: {
                        show: true,
                        fontSize: 22,
                        fontWeight: 'bold',
                        color: '#333'
                    },
                    itemStyle: {
                        shadowBlur: 15,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.3)'
                    }
                },
                labelLine: {
                    show: false
                },
                data: {{ result|safe }},
                animationType: 'scale',
                animationEasing: 'elasticOut',
                animationDelay: function (idx) {
                    return Math.random() * 200;
                }
            }
        ],
        color: [
            new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                { offset: 0, color: '#36D1DC' },
                { offset: 1, color: '#5B86E5' }
            ]),
            new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                { offset: 0, color: '#FF9A9E' },
                { offset: 1, color: '#FAD0C4' }
            ]),
            new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                { offset: 0, color: '#A1C4FD' },
                { offset: 1, color: '#C2E9FB' }
            ]),
            new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                { offset: 0, color: '#FFECD2' },
                { offset: 1, color: '#FCB69F' }
            ]),
            new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                { offset: 0, color: '#84FAB0' },
                { offset: 1, color: '#8FD3F4' }
            ]),
            new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                { offset: 0, color: '#A6C1EE' },
                { offset: 1, color: '#FBC2EB' }
            ])
        ]
    };

    option && myChart.setOption(option);

    // 响应式调整
    window.addEventListener('resize', function() {
        myChart.resize();
    });
</script>
{% endblock %}